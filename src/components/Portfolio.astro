---
// Portfolio section - Nos réalisations (Carrousel)
const projects = [
	{
		image: "/images/chantier_starlette.jpg",
		title: "Résidence Starlette – Strasbourg",
		description: "Carrelage moderne pour résidence neuve dans l'écoquartier Starlette."
	},
	{
		image: "/images/chantier_RTE_Lille.jpg",
		title: "Siège RTE – Lille",
		description: "Faïence et carrelage pour bureaux tertiaires haut de gamme."
	},
	{
		image: "/images/chantier_rive_etoile.jpeg",
		title: "Centre Commercial Rive Étoile – Strasbourg",
		description: "Cellules commerciales rénovées avec carrelage haute résistance."
	},
	{
		image: "/images/chantier_rive_du_lac.webp",
		title: "Résidence Rive du Lac – Ensisheim",
		description: "Carrelage et faïence pour nouveau programme résidentiel."
	},
	{
		image: "/images/chantier_escapade.jpg",
		title: "Programme L'Escapade – Eckbolsheim",
		description: "Logements sociaux avec carrelages durables et faciles d'entretien."
	},
	{
		image: "/images/chantier_drouot.jpg",
		title: "Quartier Drouot – Mulhouse",
		description: "Réhabilitation de 800+ logements avec modernisation des pièces humides."
	}
];
---

<section id="realisations" class="py-12 md:py-16 lg:py-20 bg-slate-50">
	<div class="container mx-auto px-4 md:px-6 lg:px-8 max-w-7xl">
		<!-- Section Header -->
		<div class="text-center mb-12">
			<h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-dark-800 leading-tight mb-4">
				Nos réalisations
			</h2>
			<p class="text-base md:text-lg text-slate-600 max-w-2xl mx-auto">
				Découvrez quelques-uns de nos projets récents. Chaque chantier est unique et reflète notre engagement pour la qualité.
			</p>
		</div>

		<!-- Carousel Container -->
		<div class="relative">
			<!-- Carousel Wrapper -->
			<div class="overflow-hidden rounded-xl" id="carousel-wrapper">
				<!-- Carousel Track -->
				<div
					id="carousel-track"
					class="flex transition-transform duration-500 ease-in-out"
					style="touch-action: pan-y pinch-zoom;"
				>
					{projects.map((project, index) => (
						<div
							class="flex-shrink-0 w-full md:w-1/2 lg:w-1/3 px-2"
							data-slide={index}
						>
							<div class="group relative overflow-hidden rounded-xl shadow-md hover:shadow-2xl transition-all duration-300">
								<!-- Image -->
								<img
									src={project.image}
									alt={project.title}
									class="w-full h-80 md:h-96 object-cover group-hover:scale-110 transition-transform duration-500"
									loading="lazy"
								/>

								<!-- Overlay on hover -->
								<div class="absolute inset-0 bg-gradient-to-t from-dark-900/90 via-dark-900/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-6">
									<div>
										<p class="text-white font-semibold text-base md:text-lg mb-1">
											{project.title}
										</p>
										<p class="text-white/80 text-sm md:text-base">
											{project.description}
										</p>
									</div>
								</div>
							</div>
						</div>
					))}
				</div>
			</div>

			<!-- Previous Button -->
			<button
				id="carousel-prev"
				type="button"
				aria-label="Image précédente"
				class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 md:translate-x-0 bg-white hover:bg-slate-100 text-dark-800 w-12 h-12 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center z-10"
			>
				<i class="fa-solid fa-chevron-left text-xl"></i>
			</button>

			<!-- Next Button -->
			<button
				id="carousel-next"
				type="button"
				aria-label="Image suivante"
				class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 md:-translate-x-0 bg-white hover:bg-slate-100 text-dark-800 w-12 h-12 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center z-10"
			>
				<i class="fa-solid fa-chevron-right text-xl"></i>
			</button>
		</div>

		<!-- Pagination Dots -->
		<div class="flex justify-center gap-2 mt-8" id="carousel-dots">
			<!-- Dots will be generated by JavaScript -->
		</div>

		<!-- Bottom Text -->
		<div class="text-center mt-12">
			<p class="text-base md:text-lg text-slate-600">
				Votre projet mérite le même soin et la même attention aux détails.
			</p>
			<a
				href="#contact"
				class="inline-block mt-6 text-gold-600 hover:text-gold-700 font-semibold text-base md:text-lg underline underline-offset-4 transition-colors"
			>
				Parlez-nous de votre projet →
			</a>
		</div>
	</div>
</section>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const track = document.getElementById('carousel-track');
		const prevButton = document.getElementById('carousel-prev');
		const nextButton = document.getElementById('carousel-next');
		const dotsContainer = document.getElementById('carousel-dots');
		const wrapper = document.getElementById('carousel-wrapper');

		if (!track || !prevButton || !nextButton || !dotsContainer || !wrapper) return;

		const slides = track.querySelectorAll('[data-slide]');
		const totalSlides = slides.length;

		let currentIndex = 0;
		let slidesPerView = getSlidesPerView();
		let maxIndex = Math.max(0, totalSlides - slidesPerView);

		// Touch/swipe support
		let touchStartX = 0;
		let touchEndX = 0;
		let isDragging = false;

		// Get slides per view based on screen size
		function getSlidesPerView() {
			const width = window.innerWidth;
			if (width >= 1024) return 3; // lg breakpoint
			if (width >= 768) return 2;  // md breakpoint
			return 1;
		}

		// Update carousel position
		function updateCarousel() {
			const slideWidth = 100 / slidesPerView;
			const offset = -(currentIndex * slideWidth);
			track.style.transform = `translateX(${offset}%)`;

			// Update dots
			updateDots();

			// Update button states
			prevButton.disabled = currentIndex === 0;
			nextButton.disabled = currentIndex >= maxIndex;

			prevButton.style.opacity = currentIndex === 0 ? '0.5' : '1';
			nextButton.style.opacity = currentIndex >= maxIndex ? '0.5' : '1';
		}

		// Create pagination dots
		function createDots() {
			dotsContainer.innerHTML = '';
			const numDots = maxIndex + 1;

			for (let i = 0; i <= maxIndex; i++) {
				const dot = document.createElement('button');
				dot.type = 'button';
				dot.setAttribute('aria-label', `Aller à la diapositive ${i + 1}`);
				dot.className = 'w-3 h-3 rounded-full transition-all duration-300';
				dot.dataset.index = i.toString();

				dot.addEventListener('click', () => {
					currentIndex = i;
					updateCarousel();
				});

				dotsContainer.appendChild(dot);
			}

			updateDots();
		}

		// Update dot states
		function updateDots() {
			const dots = dotsContainer.querySelectorAll('button');
			dots.forEach((dot, index) => {
				if (index === currentIndex) {
					dot.className = 'w-8 h-3 rounded-full bg-gold-600 transition-all duration-300';
				} else {
					dot.className = 'w-3 h-3 rounded-full bg-slate-300 hover:bg-slate-400 transition-all duration-300';
				}
			});
		}

		// Navigate to previous slide
		function goPrev() {
			if (currentIndex > 0) {
				currentIndex--;
				updateCarousel();
			}
		}

		// Navigate to next slide
		function goNext() {
			if (currentIndex < maxIndex) {
				currentIndex++;
				updateCarousel();
			}
		}

		// Handle window resize
		function handleResize() {
			const newSlidesPerView = getSlidesPerView();
			if (newSlidesPerView !== slidesPerView) {
				slidesPerView = newSlidesPerView;
				maxIndex = Math.max(0, totalSlides - slidesPerView);

				// Adjust current index if needed
				if (currentIndex > maxIndex) {
					currentIndex = maxIndex;
				}

				createDots();
				updateCarousel();
			}
		}

		// Touch event handlers
		function handleTouchStart(e) {
			touchStartX = e.touches[0].clientX;
			isDragging = true;
		}

		function handleTouchMove(e) {
			if (!isDragging) return;
			touchEndX = e.touches[0].clientX;
		}

		function handleTouchEnd() {
			if (!isDragging) return;
			isDragging = false;

			const swipeThreshold = 50;
			const diff = touchStartX - touchEndX;

			if (Math.abs(diff) > swipeThreshold) {
				if (diff > 0) {
					goNext();
				} else {
					goPrev();
				}
			}

			touchStartX = 0;
			touchEndX = 0;
		}

		// Keyboard navigation
		function handleKeyboard(e) {
			if (e.key === 'ArrowLeft') {
				e.preventDefault();
				goPrev();
			} else if (e.key === 'ArrowRight') {
				e.preventDefault();
				goNext();
			}
		}

		// Event listeners
		prevButton.addEventListener('click', goPrev);
		nextButton.addEventListener('click', goNext);

		// Touch events
		wrapper.addEventListener('touchstart', handleTouchStart, { passive: true });
		wrapper.addEventListener('touchmove', handleTouchMove, { passive: true });
		wrapper.addEventListener('touchend', handleTouchEnd);

		// Keyboard navigation
		document.addEventListener('keydown', handleKeyboard);

		// Resize handler
		let resizeTimeout;
		window.addEventListener('resize', () => {
			clearTimeout(resizeTimeout);
			resizeTimeout = setTimeout(handleResize, 150);
		});

		// Initialize
		createDots();
		updateCarousel();
	});
</script>
